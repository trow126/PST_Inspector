| バージョン | 日付 | 作成者 |
|---|---|---|
| 1.0 | 2025-10-03 |  |
1. 概要
1.1. 目的
本スクリプトは、Microsoft OutlookのPST（Personal Storage Table）ファイルを分析し、ファイル内に存在する「メール」および「会議関連アイテム」の重複を検出し、その結果を集計することを目的とする。
1.2. 機能範囲
 * 入力: ユーザーが指定した単一のPSTファイル。
 * 処理対象:
   * 通常のメール (olMailItem)
   * 会議の出席依頼 (olMeetingRequest)
   * 会議のキャンセル通知 (olMeetingCancellation)
 * 処理対象外: 上記以外のアイテム（タスク、連絡先、会議への返信など）はスキップする。
 * 出力: 標準出力（コンソール）に分析結果のサマリーを表示する。
1.3. 用語定義
 * アイテム: PSTファイル内に格納されている個々のデータ（メール、会議、連絡先など）。
 * ハッシュ値（指紋）: アイテムの内容から生成される一意の識別子。重複判定に用いる。
 * COM (Component Object Model): アプリケーション間で機能をやり取りするためのMicrosoftの技術仕様。
2. 実行環境
2.1. ハードウェア
 * 一般的なスペックのWindows PC
2.2. ソフトウェア
 * OS: Windows
 * アプリケーション: Microsoft Outlook（COMオートメーションのために必須）
 * プログラミング言語: Python 3.x
 * 必須ライブラリ: pywin32
3. 機能仕様
3.1. PSTファイル読み込み機能
スクリプト内で指定されたパスのPSTファイルを、Outlookアプリケーション経由でデータストアとして追加し、内容にアクセスする。
3.2. アイテム種別判定機能
PSTファイル内の各アイテムを巡回し、item.Classプロパティの値に基づき、以下のいずれかに分類する。
 * メール (Class: 43)
 * 会議関連 (Class: 53, 56)
 * その他（スキップ対象）
3.3. 重複判定機能
アイテムの種別ごとに異なる基準でハッシュ値（指紋）を生成し、重複を判定する。判定は、ユニークなアイテムのハッシュ値をsetオブジェクトに保存し、現在処理中のアイテムのハッシュ値がset内に存在するかどうかで判断する。
 * メールの重複基準:
   * 送信日時 (SentOn)
   * 送信者名 (SenderName)
   * 宛先 (To)
   * 件名 (Subject)
   * 本文 (Body)
 * 会議の重複基準:
   * 件名 (Subject)
   * 開始時刻 (Start)
   * 終了時刻 (End)
   * 場所 (Location)
   * 必須出席者 (RequiredAttendees)
   * 本文 (Body)
3.4. 結果出力機能
全ての処理が完了後、コンソールに以下の情報を集計して表示する。
 * ユニークなメール数
 * 重複したメール数
 * ユニークな会議数
 * 重複した会議数
 * 処理をスキップしたアイテム数
4. 設計
4.1. アーキテクチャ
 * 単一のPythonスクリプトファイルで構成される。
 * win32com.clientライブラリを利用してOutlookのCOMインターフェースを操作する。
 * PSTファイル内の階層的なフォルダ構造を探索するため、再帰関数 (process_folder) を用いる。
4.2. 処理フロー
 * 初期化: 各種カウンター変数と、ユニークなハッシュ値を保存するためのsetオブジェクトを初期化する。
 * Outlook接続: win32com.client.Dispatchを呼び出し、Outlookアプリケーションのインスタンスを生成する。
 * PSTストア追加: namespace.AddStoreメソッドで指定のPSTファイルをOutlookに追加する。
 * 再帰処理開始: ルートフォルダを引数として、再帰関数process_folderを呼び出す。
 * アイテム処理: process_folder内で、アイテムの種別判定、ハッシュ値計算、重複判定、カウンター更新を行う。
 * サブフォルダ処理: process_folder内で、サブフォルダに対して自身を再帰的に呼び出す。
 * PSTストア削除: 全ての処理が完了したら、namespace.RemoveStoreメソッドで追加したPSTストアをOutlookから削除する。
 * 結果表示: 最終的な集計結果をコンソールに出力する。
4.3. エラーハンドリング
 * 接続・ファイルオープン: Outlookへの接続やPSTファイルの読み込み処理はtry-exceptブロックで囲み、失敗した場合はエラーメッセージを表示して終了する。
 * アイテム処理: 個々のアイテムの処理もtry-exceptブロックで囲む。これにより、特定のアイテムが破損していてもスクリプト全体が停止することなく処理を継続できる。
